apiVersion: apps/v1
kind: Deployment
metadata:
  name: nats
  labels:
    app: nats
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nats
  template:
    metadata:
      labels:
        app: nats
    spec:
      containers:
      - name: nats
        image: nats:latest
        ports:
        - containerPort: 4222
        # TLS Configuration for NATS
        env:
        - name: NATS_TLS
          value: "true"
        volumeMounts:
        - name: tls-certs
          mountPath: /etc/ssl/certs
          readOnly: true
        command:
        - nats-server
        - "--tls"
        - "--tlscert"
        - "/etc/ssl/certs/tls.crt"
        - "--tlskey"
        - "/etc/ssl/certs/tls.key"
        - "--tlsverify"
        - "false"  # For demo purposes
      volumes:
      - name: tls-certs
        secret:
          secretName: nats-tls

---
apiVersion: v1
kind: Service
metadata:
  name: nats
  labels:
    app: nats
spec:
  ports:
  - port: 4222
    targetPort: 4222
  selector:
    app: nats
